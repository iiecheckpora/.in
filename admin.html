<!DOCTYPE html>
<html lang="en">
<head>
    <title>Admin Dashboard</title>
    <style>
        body { font-family: sans-serif; margin: 2rem; }
        h1, h2 { color: #333; }
        .dashboard { display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; }
        .panel { padding: 1rem; background: #f9f9f9; border-radius: 5px; box-shadow: 0 0 5px rgba(0,0,0,0.05); }
        table { width: 100%; border-collapse: collapse; }
        th, td { padding: 8px; border: 1px solid #ddd; text-align: left; }
        form input, form select, form textarea { width: 95%; padding: 8px; margin-bottom: 10px; }
        button { padding: 10px 15px; background: #28a745; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>Admin Dashboard</h1>
    <p>Welcome, <span id="adminEmail"></span>! <a href="login.html" id="logout">Logout</a></p>

    <div class="dashboard">
        <div class="panel">
            <h2>Assign New Task</h2>
            <form id="assignTaskForm">
                <input type="text" id="taskTitle" placeholder="Task Title" required>
                <textarea id="taskDesc" placeholder="Task Description"></textarea>
                <input type="email" id="assignTo" placeholder="Assign to (Volunteer Email)" required>
                <input type="date" id="dueDate" required>
                <button type="submit">Assign Task</button>
            </form>
        </div>
        <div class="panel">
            <h2>Add New Volunteer</h2>
            <form id="addVolunteerForm">
                <input type="text" id="fullName" placeholder="Full Name" required>
                <input type="email" id="volEmail" placeholder="Email" required>
                <input type="password" id="volPassword" placeholder="Temporary Password" required>
                <select id="volRole">
                    <option value="Volunteer">Volunteer</option>
                    <option value="Admin">Admin</option>
                </select>
                <button type="submit">Add Volunteer</button>
            </form>
        </div>
    </div>

    <div class="panel" style="margin-top: 2rem;">
        <h2>All Tasks (Real-time) <button id="refreshData">Refresh</button></h2>
        <div id="tasksTableContainer"></div>
    </div>
    <div class="panel" style="margin-top: 2rem;">
        <h2>All Volunteers</h2>
        <div id="volunteersTableContainer"></div>
    </div>

    <script>
        // PASTE YOUR WEB APP URL HERE
        const API_URL = "https://script.google.com/macros/s/AKfycbxvsvo97xY-vjAzsmjE8QlCIowTfPSFF_QDMgMcmKBSqHXFZqQX5KrkBvrFZU_it3sxJA/exec";

        const adminEmail = localStorage.getItem("userEmail");
        const adminRole = localStorage.getItem("userRole");

        // Security check
        if (!adminEmail || adminRole !== "Admin") {
            window.location.href = "login.html";
        }

        document.getElementById("adminEmail").textContent = adminEmail;
        document.getElementById("logout").onclick = () => localStorage.clear();
        document.getElementById("refreshData").onclick = fetchAdminData;

        function fetchAdminData() {
            document.getElementById("tasksTableContainer").innerHTML = "<p>Loading data...</p>";
            fetch(`${API_URL}?action=getAdminData`)
                .then(res => res.json())
                .then(data => {
                    renderTable(data.tasks, document.getElementById("tasksTableContainer"));
                    renderTable(data.volunteers, document.getElementById("volunteersTableContainer"));
                });
        }

        function renderTable(data, container) {
            let table = '<table>';
            data.forEach((row, index) => {
                table += '<tr>';
                if (index === 0) { // Headers
                    row.forEach(cell => table += `<th>${cell}</th>`);
                } else { // Data rows
                    row.forEach(cell => table += `<td>${cell}</td>`);
                }
                table += '</tr>';
            });
            table += '</table>';
            container.innerHTML = table;
        }

        document.getElementById("assignTaskForm").addEventListener("submit", e => {
            e.preventDefault();
            const taskData = {
                title: document.getElementById("taskTitle").value,
                description: document.getElementById("taskDesc").value,
                assignTo: document.getElementById("assignTo").value,
                dueDate: document.getElementById("dueDate").value
            };
            postData({ action: "assignTask", taskData: taskData });
        });
        
        document.getElementById("addVolunteerForm").addEventListener("submit", e => {
            e.preventDefault();
            const volunteerData = {
                fullName: document.getElementById("fullName").value,
                email: document.getElementById("volEmail").value,
                password: document.getElementById("volPassword").value,
                role: document.getElementById("volRole").value
            };
            postData({ action: "addVolunteer", volunteerData: volunteerData });
        });

        function postData(payload) {
            fetch(API_URL, {
                method: 'POST',
                body: JSON.stringify(payload)
            })
            .then(res => res.json())
            .then(data => {
                alert(data.message);
                fetchAdminData(); // Refresh data after action
            });
        }
        
        // Initial data load and periodic refresh for real-time feel
        fetchAdminData();
        setInterval(fetchAdminData, 30000); // Refresh every 30 seconds
    </script>
</body>
</html>